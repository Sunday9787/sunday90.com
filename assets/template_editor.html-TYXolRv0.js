import{_ as s,o as a,c as e,a as t,e as p,f as o}from"./app-8KgkyZWp.js";const c={};function l(i,n){return a(),e("div",null,[n[0]||(n[0]=t("p",null,"编辑器是创作者的工具箱，每一个功能键都蕴藏着无限可能...",-1)),p(" more "),n[1]||(n[1]=o(`<h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言" aria-hidden="true">#</a> 前言</h2><p>等了好久终于等到今天，梦了好久终于把梦实现...</p><h2 id="需求分析" tabindex="-1"><a class="header-anchor" href="#需求分析" aria-hidden="true">#</a> 需求分析</h2><p>编辑器，是装载画布的入口，需要实现画布的缩放功能&amp;根据鼠标位置缩放，和需要拖动画布</p><h2 id="设计" tabindex="-1"><a class="header-anchor" href="#设计" aria-hidden="true">#</a> 设计</h2><p>缩放</p><p>缩放使用css 的 scale，为了避免精度问题，采用10-100范围内数字</p><p>根据位置缩放</p><p>先计算未缩放前鼠标距离画布left&amp;top比例</p><p>再计算缩放后鼠标距离画布left&amp;top</p><p>再将左右比例从新计算即可</p><p><em>ps: 这个功能我查了好多资料,终于搞明白了🥲，不理解的仔细看代码部分注释</em></p><h2 id="视图" tabindex="-1"><a class="header-anchor" href="#视图" aria-hidden="true">#</a> 视图</h2><div class="language-vue line-numbers-mode" data-ext="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pug<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
main.template-editor
  section.template-canvas(ref=&quot;canvas&quot;)
    TemplateStage(
      :scale=&quot;scale.value&quot;
      :position=&quot;position&quot;
      :spaceDown=&quot;spaceDown&quot;
      :scale-manual=&quot;scale.manual&quot;
      @keydown.space.exact.native=&quot;spaceDownHandle&quot;
      @keyup.space.exact.native=&quot;spaceUpHandle&quot;
      ref=&quot;refComponent&quot;)
  app-scale(
    :scale.sync=&quot;scale.value&quot;
    :max-scale=&quot;scale.max&quot;
    :mini-scale=&quot;scale.mini&quot;
    :step=&quot;scale.step&quot;
    @change=&quot;scaleManual(true)&quot;)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>位置更新以及缩放通过传递<code>Props</code>由子组件<code>TemplateStage</code>渲染</p><p><strong>有一个重要的点</strong>，<code>TemplateStage</code>在使用滚轮缩放时需要设置<code>transformOrigin</code>为<code>top left</code>，在使用控制按钮缩放时，值需要为<code>center</code>这样可以保证手动缩放的时候画布始终在编辑器中间</p><h2 id="实现" tabindex="-1"><a class="header-anchor" href="#实现" aria-hidden="true">#</a> 实现</h2><h3 id="缩放" tabindex="-1"><a class="header-anchor" href="#缩放" aria-hidden="true">#</a> 缩放</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>Template<span class="token punctuation">.</span>Store<span class="token punctuation">}</span></span>
 */</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>storeSymbol<span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> refComponent <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useToHtml</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token doc-comment comment">/** 缩放比例 */</span>
<span class="token keyword">const</span> scale <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">step</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token literal-property property">max</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token literal-property property">mini</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token literal-property property">manual</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token doc-comment comment">/**
  * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>WheelEvent<span class="token punctuation">}</span></span> <span class="token parameter">e</span>
  */</span>
<span class="token keyword">const</span> <span class="token function-variable function">mousewheel</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span><span class="token function">scaleManual</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>deltaY <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>scale<span class="token punctuation">.</span>value <span class="token operator">&gt;</span> scale<span class="token punctuation">.</span>mini<span class="token punctuation">)</span> scale<span class="token punctuation">.</span>value <span class="token operator">-=</span> scale<span class="token punctuation">.</span>step
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>scale<span class="token punctuation">.</span>value <span class="token operator">&lt;</span> scale<span class="token punctuation">.</span>max<span class="token punctuation">)</span> scale<span class="token punctuation">.</span>value <span class="token operator">+=</span> scale<span class="token punctuation">.</span>step
  <span class="token punctuation">}</span>

  <span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>HTMLElement<span class="token punctuation">}</span></span> */</span>
  <span class="token keyword">const</span> stage <span class="token operator">=</span> refComponent<span class="token punctuation">.</span>value<span class="token punctuation">.</span>$el
  <span class="token keyword">const</span> rect <span class="token operator">=</span> stage<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token doc-comment comment">/** 鼠标距离元素 \`left\` 的比例 */</span>
  <span class="token keyword">const</span> leftScale <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> rect<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">/</span> rect<span class="token punctuation">.</span>width
  <span class="token doc-comment comment">/** 鼠标距离元素 \`top\` 的比例 */</span>
  <span class="token keyword">const</span> topScale <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientY <span class="token operator">-</span> rect<span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token operator">/</span> rect<span class="token punctuation">.</span>height
  <span class="token doc-comment comment">/** 缩放后的元素宽度 */</span>
  <span class="token keyword">const</span> newStageWidth <span class="token operator">=</span> store<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token punctuation">(</span>scale<span class="token punctuation">.</span>value <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span>
  <span class="token doc-comment comment">/** 缩放后的元素高度 */</span>
  <span class="token keyword">const</span> newStageHeight <span class="token operator">=</span> store<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token punctuation">(</span>scale<span class="token punctuation">.</span>value <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span>
  <span class="token doc-comment comment">/** 缩放后的鼠标距离元素 left 值 */</span>
  <span class="token keyword">const</span> newRectLeft <span class="token operator">=</span> newStageWidth <span class="token operator">*</span> leftScale
  <span class="token doc-comment comment">/** 缩放后的鼠标距离元素 top 值 */</span>
  <span class="token keyword">const</span> newRectTop <span class="token operator">=</span> newStageHeight <span class="token operator">*</span> topScale

  <span class="token comment">// 当前位置 = 当前位置 - (缩放后的 \`left/top\` - （鼠标距离元素 \`left/top\` 值))</span>
  vm<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">=</span> vm<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token punctuation">(</span>newRectLeft <span class="token operator">-</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> rect<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">)</span>
  vm<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> vm<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token punctuation">(</span>newRectTop <span class="token operator">-</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientY <span class="token operator">-</span> rect<span class="token punctuation">.</span>top<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span>$el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousewheel&#39;</span><span class="token punctuation">,</span> mousewheel<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">onBeforeUnmount</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span>$el<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousewheel&#39;</span><span class="token punctuation">,</span> mousewheel<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="拖拉" tabindex="-1"><a class="header-anchor" href="#拖拉" aria-hidden="true">#</a> 拖拉</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 初始化 画布位置
     */</span>
    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>HTMLElement<span class="token punctuation">}</span></span> */</span>
      <span class="token keyword">const</span> canvas <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>canvas

      <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>offsetWidth <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
      <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>offsetHeight <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">=</span> x
      <span class="token keyword">this</span><span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> y
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>KeyboardEvent<span class="token punctuation">}</span></span> <span class="token parameter">e</span>
     */</span>
    <span class="token function">spaceDownHandle</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>HTMLElement<span class="token punctuation">}</span></span> */</span>
      <span class="token keyword">const</span> target <span class="token operator">=</span> e<span class="token punctuation">.</span>target
      <span class="token keyword">this</span><span class="token punctuation">.</span>spaceDown <span class="token operator">=</span> <span class="token boolean">true</span>
      target<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cursor <span class="token operator">=</span> <span class="token string">&#39;grab&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>KeyboardEvent<span class="token punctuation">}</span></span> <span class="token parameter">e</span>
     */</span>
    <span class="token function">spaceUpHandle</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>HTMLElement<span class="token punctuation">}</span></span> */</span>
      <span class="token keyword">const</span> target <span class="token operator">=</span> e<span class="token punctuation">.</span>target
      target<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cursor <span class="token operator">=</span> <span class="token string">&#39;default&#39;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>spaceDown <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>boolean<span class="token punctuation">}</span></span> <span class="token parameter">manual</span> 是否点击缩放
     */</span>
    <span class="token function">scaleManual</span><span class="token punctuation">(</span><span class="token parameter">manual</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>scale<span class="token punctuation">.</span>manual <span class="token operator">=</span> manual
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>空格+鼠标左键可实现拖动画布，默认将画布定位到编辑器中间，比较easy，你肯定能看懂</p><h2 id="最后" tabindex="-1"><a class="header-anchor" href="#最后" aria-hidden="true">#</a> 最后</h2><p>根据鼠标位置缩放这个实现原理希望你能看懂，这样就会跟我一样强</p><figure><img src="https://static-1256180570.cos.ap-nanjing.myqcloud.com/image/1732983146.jpg?imageMogr2/interlace/1/quality/100/thumbnail/350x" alt="-1c699959fbc944f7" tabindex="0" loading="lazy"><figcaption>-1c699959fbc944f7</figcaption></figure>`,25))])}const r=s(c,[["render",l],["__file","template_editor.html.vue"]]);export{r as default};
