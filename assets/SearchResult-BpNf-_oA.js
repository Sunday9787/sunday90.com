import{h as W,u as U,j as F,J as X,k as Z,l as I,m as L,p as ee,R as ae,O as le,q as w,s as se,v as te,x as M,y as re,z as ue,A as D,B as ie,C as l,D as $,E as b,G as _,H as ne,I as oe,K as ce,L as ve,M as pe,N as ye,P as he}from"./app-DrKNV5QG.js";const de="SEARCH_PRO_QUERY_HISTORY",h=I(de,[]),me=()=>{const{queryHistoryCount:r}=L;return{enabled:r>0,queryHistory:h,addQueryHistory:t=>{h.value.length<r?h.value=Array.from(new Set([t,...h.value])):h.value=Array.from(new Set([t,...h.value.slice(0,r-1)]))},removeQueryHistory:t=>{h.value=[...h.value.slice(0,t),...h.value.slice(t+1)]}}},He="SEARCH_PRO_RESULT_HISTORY",{resultHistoryCount:E}=L,d=I(He,[]),fe=()=>{const r=U(),p=E>0,t=s=>r.resolve({name:s.key,..."anchor"in s?{hash:`#${s.anchor}`}:{}}).fullPath;return{enabled:p,resultHistory:d,addResultHistory:s=>{{const i={link:t(s),display:s.display};"header"in s&&(i.header=s.header),d.value.length<E?d.value=[i,...d.value]:d.value=[i,...d.value.slice(0,E-1)]}},removeResultHistory:s=>{d.value=[...d.value.slice(0,s),...d.value.slice(s+1)]}}},ge=r=>{const p=ae(),t=F(),{search:s,terminate:i}=le(),m=w(!1),y=se([]);return te(()=>{const R=()=>{y.value=[],m.value=!1},H=re(f=>{m.value=!0,f?s({type:"search",query:f,locale:t.value,options:p}).then(g=>{y.value=g,m.value=!1}).catch(g=>{console.error(g),R()}):R()},L.searchDelay);M([r,t],()=>H(r.value),{immediate:!0}),ue(()=>{i()})}),{searching:m,results:y}};var Re=W({name:"SearchResult",props:{query:{type:String,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(r,{emit:p}){const t=U(),s=F(),i=X(Z),{addQueryHistory:m,queryHistory:y,removeQueryHistory:R}=me(),{resultHistory:H,addResultHistory:f,removeResultHistory:g}=fe(),S=ee(r,"query"),{results:Q,searching:j}=ge(S),n=w({isQuery:!0,index:0}),v=w(0),o=w(0),O=D(()=>y.value.length>0||H.value.length>0),q=D(()=>Q.value.length>0),C=D(()=>Q.value[v.value]||null),P=e=>t.resolve({name:e.key,..."anchor"in e?{hash:`#${e.anchor}`}:{}}).fullPath,B=()=>{const{isQuery:e,index:a}=n.value;a===0?n.value={isQuery:!e,index:e?H.value.length-1:y.value.length-1}:n.value={isQuery:e,index:a-1}},J=()=>{const{isQuery:e,index:a}=n.value;a===(e?y.value.length-1:H.value.length-1)?n.value={isQuery:!e,index:0}:n.value={isQuery:e,index:a+1}},Y=()=>{v.value=v.value>0?v.value-1:Q.value.length-1,o.value=C.value.contents.length-1},z=()=>{v.value=v.value<Q.value.length-1?v.value+1:0,o.value=0},G=()=>{o.value<C.value.contents.length-1?o.value=o.value+1:z()},K=()=>{o.value>0?o.value=o.value-1:Y()},A=e=>e.map(a=>ne(a)?a:l(a[0],a[1])),N=e=>{if(e.type==="customField"){const a=ye[e.index]||"$content",[u,x=""]=he(a)?a[s.value].split("$content"):a.split("$content");return e.display.map(c=>l("div",A([u,...c,x])))}return e.display.map(a=>l("div",A(a)))},k=()=>{v.value=0,o.value=0,p("updateQuery",""),p("close")};return ie("keydown",e=>{if(r.isFocusing){if(q.value){if(e.key==="ArrowUp")K();else if(e.key==="ArrowDown")G();else if(e.key==="Enter"){const a=C.value.contents[o.value],u=P(a);m(r.query),f(a),t.push(u),k()}}else if(e.key==="ArrowUp")B();else if(e.key==="ArrowDown")J();else if(e.key==="Enter"){const{index:a}=n.value;n.value.isQuery?(p("updateQuery",y.value[a]),e.preventDefault()):(t.push(H.value[a].link),k())}}}),M([v,o],()=>{var e;(e=document.querySelector(".search-pro-result-list-item.active .search-pro-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>l("div",{class:["search-pro-result-wrapper",{empty:S.value?!q.value:!O.value}],id:"search-pro-results"},S.value===""?O.value?[l("ul",{class:"search-pro-result-list"},l("li",{class:"search-pro-result-list-item"},[l("div",{class:"search-pro-result-title"},i.value.queryHistory),y.value.map((e,a)=>l("div",{class:["search-pro-result-item",{active:n.value.isQuery&&n.value.index===a}],onClick:()=>{p("updateQuery",e)}},[l($,{class:"search-pro-result-type"}),l("div",{class:"search-pro-result-content"},e),l("button",{class:"search-pro-remove-icon",innerHTML:b,onClick:u=>{u.preventDefault(),u.stopPropagation(),R(a)}})]))])),l("ul",{class:"search-pro-result-list"},l("li",{class:"search-pro-result-list-item"},[l("div",{class:"search-pro-result-title"},i.value.resultHistory),H.value.map((e,a)=>l(_,{to:e.link,class:["search-pro-result-item",{active:!n.value.isQuery&&n.value.index===a}],onClick:()=>{k()}},()=>[l($,{class:"search-pro-result-type"}),l("div",{class:"search-pro-result-content"},[e.header?l("div",{class:"content-header"},e.header):null,l("div",e.display.map(u=>A(u)).flat())]),l("button",{class:"search-pro-remove-icon",innerHTML:b,onClick:u=>{u.preventDefault(),u.stopPropagation(),g(a)}})]))]))]:i.value.emptyHistory:j.value?l(oe,{hint:i.value.searching}):q.value?l("ul",{class:"search-pro-result-list"},Q.value.map(({title:e,contents:a},u)=>{const x=v.value===u;return l("li",{class:["search-pro-result-list-item",{active:x}]},[l("div",{class:"search-pro-result-title"},e||i.value.defaultTitle),a.map((c,V)=>{const T=x&&o.value===V;return l(_,{to:P(c),class:["search-pro-result-item",{active:T,"aria-selected":T}],onClick:()=>{m(r.query),f(c),k()}},()=>[c.type==="text"?null:l(c.type==="title"?ce:c.type==="heading"?ve:pe,{class:"search-pro-result-type"}),l("div",{class:"search-pro-result-content"},[c.type==="text"&&c.header?l("div",{class:"content-header"},c.header):null,l("div",N(c))])])})])})):i.value.emptyResult)}});export{Re as default};
